\usepackage{emptypage}
\usepackage{ulem}
\usepackage[utf8]{inputenc}
\usepackage{ctex}
\usepackage{indentfirst}
\usepackage{hyperref}
\usepackage{color}

\newcommand{\blankpage}{\newpage \vfill}

\usepackage{titletoc}

\usepackage{geometry}
\geometry{
  paperwidth=154mm,
  paperheight=216mm,
  total={120mm,175mm},
  left=17mm,
  top=23mm,
}

\hypersetup{hidelinks}

\usepackage{framed}

\renewcommand{\contentsname}{\youyuan\vspace{-4em} 目\hspace{1em}录}


\renewenvironment{leftbar}
{\def\FrameCommand{%
    \hspace{2em}{\color{black}\vrule width 2pt depth 6pt}\hspace{1em}}%
  \MakeFramed{\parshape 1 0cm \dimexpr\textwidth-6em\relax\FrameRestore}\vskip2pt%
}
{\endMakeFramed}

\usepackage{titletoc}

\setcounter{tocdepth}{1}
\counterwithout{section}{chapter}
\counterwithout{subsection}{section}

\titlecontents{chapter}
[0em]
{\Large\bfseries\sffamily}
{\vspace{0.5em}\hspace{-4em}\parbox{6.5em}{\vspace{0.8em}\hfill\Large\bfseries\color{black}\thecontentspage}\vspace*{-1.9\baselineskip}\leftbar\lishu\bfseries}
{}{\endleftbar}

\titlecontents{section}
[5em]
{\rmfamily\color{black}}
{\S \hspace{0.5em}\thecontentslabel\hspace{1em}}{}
{\phantom{    }\dotfill \nobreak\itshape\contentspage}

\usepackage{titlesec}

\titleformat{\chapter}{\huge\bfseries\yahei}{\thispagestyle{empty}}{1em}{}

\titleformat{\section}{\bfseries\sffamily}{Chapter~\thesection}{1em}{}

\titleformat{\subsection}{\sffamily}{0\thesubsection}{1em}{}

\titlespacing*{\chapter}{1em}{5em}{1em}
\titlespacing*{\section}{4em}{1em}{1em}
\titlespacing*{\subsection}{2em}{1em}{1em}

\usepackage{fancyhdr}

\newcommand{\mytitle}{封面标题}
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}}
\renewcommand{\headrulewidth}{0pt}
\fancypagestyle{mystyle}{
  \fancyhf{}
  \fancyhead[LE,RO]{\thepage}
  \fancyhead[CE]{\mytitle}
  \fancyhead[CO]{\leftmark}
}

\newcommand{\storyend}[1][完]{
  \vspace{5em}
  \hfill #1 \hspace{5em}
  \vspace{3em}
}

\usepackage{etoolbox}
\AtBeginEnvironment{quote}{\itshape}
